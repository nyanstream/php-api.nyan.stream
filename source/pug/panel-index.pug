|<?php
|	date_default_timezone_set('Europe/Moscow');
|	include_once 'ü§´/panel-core.php';
|
|	$isAdminUser = in_array($_SERVER['PHP_AUTH_USER'], $adminUsers);
|?>
doctype html
html(lang='ru')
	head
		include inc/vars.pug
		include inc/mixins.pug
		- var subTitle = 'Panel'

		meta(charset='utf-8')
		title #{title.toUpperCase()} / #{subTitle}

		| <?php if (isset($_GET['action'])) echo '
		script document.location.href="'. $_SERVER['PHP_SELF'] .'"
		noscript #[meta(refresh="0; '. $_SERVER['PHP_SELF'] .'")]
		|'; ?>

		include inc/meta-viewport.pug
		meta(name='robots' content='noindex, nofollow')

		link(rel='shortcut icon' href=`${URLs.favicon}`)

		include inc/meta-font.pug

		link(rel='stylesheet' href=`${PATHS.css}/admin-panel.min.css?v=${VERSION}`)
	body
		div.container
			main.panel
				form(action='?action' method='post')
					fieldset.add-air
						legend –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —ç—Ñ–∏—Ä–∞
						p
							label –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞:
							input#time_start(name='time_start' type='datetime-local' value='2016-05-06T00:00' required)
							br
							em.text-m-m –í—Ä–µ–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–æ—Å–∫–æ–≤—Å–∫–∏–º.
						p
							label –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
							input#duration(name='duration' type='number' min='1' placeholder='60')
							label(for='duration') –º–∏–Ω.
							br
							em.text-m-m –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –≤—Ä–µ–º—è —ç—Ñ–∏—Ä–∞ &ndash; 1 —á–∞—Å.
						p
							label(for='air_name') –ù–∞–∑–≤–∞–Ω–∏–µ:
							input#air_name(name='air_name' type='text'  placeholder='Binan Koukou Chikyuu Bouei-bu LOVE! (1-2 NEW)' required)
						p
							label(for='air_link') –°—Å—ã–ª–∫–∞:
							input#air_link(name='air_link' type='text' placeholder='https://shikimori.org/animes/1639')
							br
							em.text-m-m –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ.
						p(style='display: none')
							label(for='air_is_secret') –≠—Ñ–∏—Ä —Å–µ–∫—Ä–µ—Ç–Ω—ã–π?
							input#air_is_secret(name='air_is_secret' type='checkbox')
							br
							em.text-m-m –ù–µ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏, —É–¥–∞–ª–∏—Ç—å –µ–≥–æ —Ç–∞–∫–∂–µ –±—É–¥–µ—Ç –Ω–µ–ª—å–∑—è.
						p.add-air-as-backup
							label(for='air_is_backup') –≠—Ñ–∏—Ä –Ω–∞ backup-–ø–æ—Ç–æ–∫–µ?
							input#air_is_backup(name='air_is_backup' type='checkbox')
							br
						p.submit
							input(name='add_air' type='submit' value='–î–æ–±–∞–≤–∏—Ç—å')
							label #[i.text-m –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–≤–µ–¥—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!]
				form(action='?action' method='post')
					fieldset.rm-air
						legend –£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç—Ñ–∏—Ä –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
						p
							span –ü–æ—Å–ª–µ–¥–Ω–∏–π —ç—Ñ–∏—Ä: #[samp.info]
						p
							label(for='rm_air_cnf') –í—ã —Ç–æ—á–Ω–æ —ç—Ç–æ–≥–æ —Ö–æ—Ç–∏—Ç–µ?
							input#rm_air_cnf(name='rm_air_cnf' type='checkbox' required)
						p.submit
							input(name='rm_air' type='submit' value='–£–¥–∞–ª–∏—Ç—å')

				| <?php if ($isAdminUser == true): ?>

				form(action='?action' method='post')
					fieldset.expired-clear
						legend –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —ç—Ñ–∏—Ä—ã –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
						p #[samp.count]
						p
							label(for='expire_chear_cnf') –í—ã —Ç–æ—á–Ω–æ —ç—Ç–æ–≥–æ —Ö–æ—Ç–∏—Ç–µ?
							input#expire_chear_cnf(name='expire_chear_cnf' type='checkbox' required)
						p.submit
							input(name='expired_clear' type='submit' value='–£–¥–∞–ª–∏—Ç—å')

				form(action='?action' method='post')
					fieldset.noti
						legend –†–∞–±–æ—Ç–∞ —Å –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ–º
						p.noti-text.text-m
						p
							label(for='noti_text') –¢–µ–∫—Å—Ç:
							input#noti_text(name='noti_text' type='text' placeholder='–Ω–∞–ø—Ä. –†–æ–∑—ã–≥—Ä—ã—à BMW M3, –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏!' required)
						details.text-m
							summary –ü–∞–º—è—Ç–∫–∞ –ø–æ —Ä–∞–∑–º–µ—Ç–∫–µ
							p –î–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å #[kbd &lt;b&gt;#[b –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç]&lt;/b&gt;] –∏ #[kbd &lt;i&gt;#[i –∫—É—Ä—Å–∏–≤]&lt;/i&gt;], –¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –∞–±–∑–∞—Ü—ã —Å –ø–æ–º–æ—â—å—é #[kbd &lt;br&gt;].#[br]–°—Å—ã–ª–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–∞ #[kbd &lt;a href="https://..."&gt;—Ç–µ–∫—Å—Ç&lt;/a&gt;]. –í —Å–ª—É—á–∞–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å #[kbd &lt;a href="/pisos"&gt;&lt;—Ç–µ–∫—Å—Ç&lt;/a&gt;].
						p
							label(for='noti_color') –¶–≤–µ—Ç —Ñ–æ–Ω–∞:
							input#noti_color(name='noti_color' type='color' value='#ffffff')
							br
							em.text-m-m –ü–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º –ø—Ä–∏—á–∏–Ω–∞–º —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—ã–±–∏—Ä–∞—Ç—å —Å–≤–µ—Ç–ª—ã–µ —Ü–≤–µ—Ç–∞.
						p
							label(for='noti_rm') –£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ?
							input#noti_rm(name='noti_rm' type='checkbox')
						p.submit
							input(name='noti' type='submit' value='–°–æ–∑–¥–∞—Ç—å')
				fieldset.vk-link
					legend –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –¥–æ—Å—Ç—É–ø–∞ –í–ö
					p

				| <?php endif ?>

				footer.text-m
					p –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è: #[span.tsAnime]
					p –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è: #[span.tsNoti]
					p –ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ): #[span.tsCurrent]

		+libFromCDN(`moment.js/${libsVer.moment.same.v}/moment.min.js`, libsVer.moment.same.sri)
		+libFromCDN(`moment.js/${libsVer.moment.same.v}/locale/ru.js`, libsVer.moment.same.sriLocale)
		+libFromCDN(`moment-timezone/${libsVer.moment.timezone.v}/moment-timezone-with-data.min.js`, libsVer.moment.timezone.sri)

		each JS in ['kamina', 'admin-panel']
			script(src=`${PATHS.js}/${JS}.min.js?v=${VERSION}` defer)

		|<?php
		|	$PHP_data = [
		|		'timezone' => date_default_timezone_get(),
		|		'user' => $isAdminUser,
		|		'sched' => [
		|			'count' => $schedAnime_count,
		|			'countExpr' => countExprs($schedAnime_data_tmp),
		|			'latest' => [
		|				'is' => $schedAnime_latest ? true : false,
		|				'title' => $schedAnime_latest ? $schedAnime_latest['title'] : '',
		|				'start' => $schedAnime_latest ? $schedAnime_latest['s'] : null,
		|				'end' => $schedAnime_latest ? $schedAnime_latest['e'] : null,
		|			]
		|		],
		|		'ts' => [
		|			'anime' => filemtime($file['sched']),
		|			'noti' => filemtime($file['noti']),
		|			'current' => time()
		|		]
		|	];
		|	if ($isAdminUser) {
		|		$PHP_data['noti'] = [
		|			'enabled' => $noti_data['enabled'],
		|			'text' => $noti_data['text'] ? $noti_data['text'] : '',
		|			'color' => isset($noti_data['color']) ? $noti_data['color'] : false
		|		];
		|		$PHP_data['vk'] = [
		|			'URL' => $APIep['vk_au'],
		|			'appID' => $vkData['id'],
		|			'api' => 'api-backend-vk.php'
		|		];
		|		$PHP_data['server'] = $_SERVER['SERVER_NAME'];
		|	}
		|?>

		script
			|<?php echo "document.addEventListener('DOMContentLoaded', () => { initAdminPanel(" . json_encode($PHP_data, JSON_UNESCAPED_UNICODE) . ") })" ?>
